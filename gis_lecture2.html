<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<!-- For Google search results -->
		<title>ArcGIS for Economics: Lecture 2</title>
		<meta name="description" content="ArcGIS's Spatial Join for economics researchers">
		<meta name="author" content="Masayuki Kudamatsu">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<!-- Activate Reveal.js -->
		<link rel="stylesheet" href="css/reveal.css">

		<!-- Define the theme -->
		<link rel="stylesheet" href="css/theme/white4me.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/tomorrow.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--Add support for earlier versions of Internet Explorer -->
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<!-- To activate the CSS framework of Reveal.js -->
		<div class="reveal">

			<!-- To reconfigure an HTML5 <section> element as a slide using CSS. -->
			<div class="slides">

				<!-- Slide contents start here -->

				<!-- My own slide templates -->
				<section id="title">
					<h3 style="color:slategrey">
						Causal Inference with Spatial Data
					</h3>
					<p style="color:slategrey">
 						(ArcGIS 10 for Economics Research)
					</p>
					<h3>
						Lecture 2
					</h3>
					<h2>
						Spatial Join
					</h2>
					<br>
					<p>Masayuki Kudamatsu</p>
					<p>28 August, 2018</p>
					<br>
					<p>
						<small>Press SPACE to proceed. </small>
						<br>
						<small>To go back to the previous slide, press SHIFT+SPACE. </small>
					</p>
				</section>

				<section id="what_is_spatial_join" data-transition="slide-in fade-out" style="text-align: left;">
					<h3>
						What is Spatial Join?
					</h3>
						<p>
							Match <strong>features</strong> from two vector datasets by location
						</p>
						<ul>
							<li>
								No need of common keys (e.g. district code) to match data
							</li>
							<li>
								Allow you to match administrative data with <strong>natural environment data</strong>
							</li>
						</ul>
				</section>

				<section id="biome" data-transition="fade-in fade-out" style="text-align: left;">
					<h4>
						Example: <a href="https://www.worldwildlife.org/publications/terrestrial-ecoregions-of-the-world">Terrestrial Ecoregions</a>
					</h4>
						<img src="gis_lecture2/biome.png"  style="border: none; background: none; box-shadow:none; width: 600px;">
						<p>
							<a href="http://doi.org/10.1093/qje/qjx030">Henderson et al. (2018)</a> find these ecoregions predict where economic activities take place
						</p>
						<p>
							But we cannot easily match this data to administrative areas without spatial join
						</p>
				</section>

				<section id="benefits" data-transition="fade-in slide-out" style="text-align: left;">
					<h3>
						Spatial Join and Weather Data
					</h3>
					<p>
						Weather data: increasingly popular among economists
					</p>
					<ul>
						<li>
							Interest in climate change (<a href="http://doi.org/10.1257/jel.52.3.740" target="_blank">Dell et al. (2014)</a> for a survey)
						</li>
						<li>
							Since weather is exogenous, causality can be established
						</li>
					</ul>
					<p>
						But <strong>grid cells</strong> are the units of observation in weather data
					</p>
					<p>
						How can we match weather with socio-economic units?
					</p>
					<p>
						$\Rightarrow$ Spatial Join helps
					</p>
				</section>

				<section id="road_map" style="text-align: left;">
					<h3>
						Today's road map
					</h3>
						<p>
							1. Alsan (2015)
						</p>
						<p>
							2. Replicate Alsan (2015)
						</p>
						<p>
							3. Introduction to Python for ArcGIS
						</p>
				</section>

			<!-- SECTION 2 -->
			<section>
				<section id="section2">
					<h1>
						1. <a href="http://dx.doi.org/10.1257/aer.20130604" target="_blank">Alsan (2015)</a>
					</h1>
					<img src="gis_lecture2/Tsetsefly.jpg" style="border: none; background: none; box-shadow:none; width: 400px;">
				</section>

				<section id="rq2" style="text-align: left;">
					<h3>Research Question</h3>
					<p>
						Did Tsetse flies cause Africa's underdevelopment?
					</p>
					<p>
						Important?
					</p>
					<ul>
						<li>
							Tsetse flies: believed to be the cause of low agricultural productivity and high transportation cost historically
						</li>
						<li>
							Path dependence may explain Africa's underdevelopment today
						</li>
					</ul>
					<p>
						Original?
					</p>
					<ul>
						<li>
							No systematic evidence on the impact of Tsetse flies
						</li>
						<li>
							Find Tsetse flies prevented political centralization
						</li>
					</ul>
					<p>
						Feasible?
					</p>
				</section>

				<section id="data2" style="text-align: left;">
					<h3>Data</h3>
					<p>
						Ethnographic Atlas + <a href="../gis_lecture1.html#/oldmap2b" target="_blank">Murdock (1959)'s map</a>
					</p>
					<ul>
						<li>
							Pre-colonial data on use of domesticated animals, presence of intensive agriculture, political centralization
						</li>
					</ul>
					<p>
						Weather in 1871 from the 20th century reanalysis at 2&degx2&deg resolution
					</p>
					<ul>
						<li>
							Average daily mean temperature / humidity: fed into a model to predict Tsetse fly survival
						</li>
					</ul>
					<p>
						Ethnic homeland polygons matched with weather grid points? (no description in the text)
					</p>
				</section>

				<section id="equation2" style="text-align: left">
					<h3>
						Empirical specification
					</h3>
					<p>
						<!-- Case by Case -->
						\begin{align*}
						Y_j =
						  \alpha + \delta TSI_j + \boldsymbol{X}'_{j}\boldsymbol{\omega} + \varepsilon_{j}
						\end{align*}
					</p>
					<table border="0" width="100%">
						<tr>
							<td style="text-align: right">$Y_j$</td>
							<td>Precolonial outcome for ethnic group $j$</td>
						</tr>
						<tr>
							<td style="text-align: right">$TSI_j$</td>
							<td>Tsetse fly suitability index</td>
						</tr>
						<tr>
							<td style="text-align: right">$\boldsymbol{X}_j$</td>
							<td>Controls (incl.\ temperature, humidity in 1871)</td>
						</tr>
					</table>
				</section>

				<section id="result2" >
					<h4>
						Main Results
					</h4>
					<p>
					<img src="gis_lecture2/alsan_table1.png" style="border: none; background: none; box-shadow:none; width: 750px;">
						<small>(Table 1 of Alsan 2015)</small>
					</p>
				</section>

			</section>

				<section id="preparation1" data-transition="fade-out slide-in" style="text-align: left;">
					<h3>
						Prepare for the rest of this lecture
					</h3>
					<ol>
						<li>
							<a href="https://www.dropbox.com/s/2mx280kfp12j1n5/Lecture2.zip?dl=0" target="_blank">Download the zipped dataset for lecture 2</a>
						</li>
						<ul>
							<li>Save it in Desktop</li>
						</ul>
						<li>
							To unzip, right-click it and choose <span style="background-color: Gainsboro">7-Zip > Extract to "Lecture2\"</span>
						</li>
						<li>
							Launch ArcMap 10 (it takes time)
						</li>
					</ol>
				</section>

				<section id="preparation2" data-transition="fade-out fade-in" style="text-align: left;">
					<h3>
						Prepare for the rest of this lecture
					</h3>
					<p>
						Browse the inside of the <code>Lecture2</code> folder
					</p>
					<p>
						I've created four folders: <code>code</code>, <code>input</code>, <code>output</code>, <strong>and <code>temp</code></strong>
					</p>
					<ul style="margin-left: 72px;">
						<li>
							 <code>code</code>: files that edit datasets (e.g. Python scripts)
						</li>
						<li>
							<code>input</code>: original data files
						</li>
						<li>
							<code>output</code>: data files you have created
						</li>
						<li>
							<strong><code>temp</code>: intermediate data files</strong>
  					</li>
					</ul>
					<p>
						ArcGIS tends to create lots of intermediate data files to create one data file that you really need.
					</p>
				</section>

			<section>
				<section id="section5">
					<h1>
						2. Replicate Alsan (2015)
					</h1>
				</section>

				<section id="what_we_learn" style="text-align: left;">
					<h3>
						we will learn how to:
					</h3>
					<p>1. Use the Spatial Join tool (Exercise 2)</p>
					<p>2. Export attribute tables to Stata (Exercise 3)</p>
					<p>3. Create a <strong>graticule</strong> shapefile (Exercise 1)</p>
					<img src="gis_lecture2/graticule.png" style="border: none; background: none; box-shadow:none; width: 300px;">
					<p><small>(Image taken from ArcGIS Help "What are grids and graticules?")</small></p>
				</section>

				<section id="graticule" style="text-align: left;">
					<h3>
						Why graticule shapefile?
					</h3>
					<p>
						In some datasets (weather data in particular), the unit of observations is a grid point (latitude and longitude at equal intervals).
					</p>
					<p>
						Examples other than what we have already seen:
					</p>
						<ul style="margin-left: 60px;">
							<li>WorldClim (<a href="http://dx.doi.org/10.1257/aer.99.2.198" target="_blank">Dell, Jones, & Olken 2009</a>)</li>
							<li>GCPC (<a href="http://www.jstor.org/stable/10.1086/421174" target="_blank">Miguel et al. 2004</a>)</li>
							<li>TOMS air pollution index (<a href="http://dx.doi.org/10.3368/jhr.44.4.916" target="_blank">Jayachandran 2009</a>)</li>
						</ul>
					<p>
						A graticule shapefile allows you to spatially merge such data with other data
					</p>
				</section>

				<section id="ex1a" style="text-align: left;">
					<h4>
					Exercise #1
					</h4>
					<h3>
						Create 20th-century Reanalysis data grid cell polygons
					</h3>
					<p>
						Geo-processing tools to be used for this exercise:
					</p>
						<ol>
							<li>
								Create Fishnet
							</li>
							<li>
								Define Projection (Data Management)
							</li>
							<li>
								Add Geometry Attributes
							</li>
						</ol>
					<p>
						As in Lecture 1, we use these tools in Model Builder.
					</p>
						<ol>
							<li>
								<a href="../gis_lecture1.html#/modelbuilder1" target="_blank">Create a Model</a>
							</li>
							<li>
								<a href="../gis_lecture1.html#/modelbuilder3" target="_blank">Save it</a> as "lecture2.tbx/exercise1" in "Lecture 2"
							</li>
						</ol>
				</section>

				<section id="ex1b" style="text-align: left;">
					<h4>
					Exercise #1 (cont.)
					</h4>
					<h3>
						20th-century Reanalysis data
					</h3>
					<p>
						Spatial resolution: 2&deg x 2&deg
					</p>
					<p>
						Africa: roughly spans within
					</p>
					<ul>
						<li>40&deg S to 40&deg N</li>
						<li>20&deg W to 60&deg E</li>
					</ul>
					<p>
						$\Rightarrow$ Create square polygons whose centroid is from (-20&deg, -40&deg) to (60&deg, 40&deg) at the interval of 2&deg
					</p>
					<ul>
						<li>We will see why polygons, not points</li>
					</ul>
				</section>

				<section id="fishnet1" data-transition="slide-in fade-out" style="text-align: left;">
					<h4>
					Exercise #1: Step 1
					</h4>
					<h3>
						Create Fishnet
					</h3>
					<p>
						<strong>Output Feature Class</strong>: <code>\Lecture2\output\fishnet.shp</code>
					</p>
					<ul>
						<li>
							Always good idea to save outputs in a different directory (<code>Lecture2/output</code>, in this case)
						</li>
					</ul>
					<p>
						<strong>Fishnet Origin Coordinate</strong>
					</p>
					<p style="margin-left: 60px;">
						<strong>X Coordinate</strong>: -21
					</p>
					<p style="margin-left: 60px;">
						<strong>Y Coordinate</strong>: -41
					</p>
					<p>
						$\Rightarrow$ Bottom-left polygon's centroid will be (-20&deg, -40&deg)
					</p>
				</section>
				<section id="fishnet2" data-transition="fade" style="text-align: left;">
					<h3>
						Create Fishnet (cont.)
					</h3>
					<p>
						<strong>Y-Axis Coordinate</strong>
					</p>
					<p style="margin-left: 60px;">
						<strong>X Coordinate</strong>: -21
					</p>
					<p style="margin-left: 60px;">
						<strong>Y Coordinate</strong>: -10 (or any value other than -41)
					</p>
					<p>
						$\Rightarrow$ Y-Axis will be perpendicular to the horizontal X-Axis
					</p>
					<p>
						<strong>Number of Rows</strong>: 41
					</p>
					<ul>
						<li>
							(40-(-40))/2 + 1 = 41
						</li>
					</ul>
					<p>
						<strong>Number of Columns</strong>: 41
					</p>
					<ul>
						<li>
							(60-(-20))/2 + 1 = 41
						</li>
					</ul>
				</section>
				<section id="fishnet3" data-transition="slide-out fade-in" style="text-align: left;">
					<h3>
						Create Fishnet (cont.)
					</h3>
					<p>
						Uncheck "<strong>Create Label Points</strong>"
					</p>
					<ul>
						<li>
							Label points: unnecessary for our purpose
						</li>
						<li>
							Model Builder will still show label points as an output from Create Fishnet. This is a bug.
						</li>
					</ul>
					<p>
						<strong>Geometry Type</strong>: POLYGON
					</p>
					<ul>
						<li>
							By default, this option is set as POLYLINE. Make sure to change it.
						</li>
					</ul>
				</section>

				<section id="ex1ba" data-transition="slide-in fade-out" style="text-align: left;">
					<h4>
					Exercise #1: Step 2
					</h4>
					<p>
						The Create Fishnet tool doesn't assign any coordination system to the output file
					</p>
					<p>
						Ethnographic Atlas data uses geographic coordinate system
					</p>
					<p>
						$\Rightarrow$ Assign WGS 1984
					</p>
					<p>
						How? We already learned this in <a href="../gis_lecture1.html#/ex6a" target="_blank">Lecture 1 Exercise 6</a>.
					</p>
				</section>

				<section id="define_projection" data-transition="slide-out fade-in" style="text-align: left;">
					<h4>
					Exercise #1: Step 2  (cont.)
					</h4>
					<h3>
						Define Projection (Data Management)
					</h3>
					<p>
						<strong>Input Dataset or Feature Class</strong>: fishnet.shp
					</p>
					<ul>
						<li>
							Use the drop down menu to choose the output from Create Fishnet
						</li>
					</ul>
					<p>
						<strong>Coordinate System</strong>: GCS_WGS_1984
					</p>
					<ul style="margin-left: 60px;">
						<li>
							Click <img src="gis_lecture2/coordinate.png" style="border: none; background: none; box-shadow:none; width:40px; vertical-align: middle;">
						</li>
						<li>
							Navigate to Geographic Coordinate Systems > World > WGS 1984
						</li>
					</ul>
				</section>

				<section id="ex1c" style="text-align: left;">
					<h4>
					Exercise #1 (cont.)
					</h4>
					<p>
						Now <em>save and</em> run the Model.
					</p>
					<p>
						Browse the output.
					</p>
					<p>
						Overlay the Ethnographic Atlas data
					</p>
					<ul>
						<li>
							<code>.../Lecture2/input/tribemap.shp</code>
						</li>
					</ul>
					<p>
						20th Century Reanalysis data cell polygons should cover the whole mainland Africa.
					</p>
				</section>

				<section id="ex1d" data-transition="slide-in fade-out" style="text-align: left;">
					<h4>
					Exercise #1: Step 3
					</h4>
					<p>
						Browse the attribute table of the output (cf. <a href="../gis_lecture1.html#/attribute_table" target="_blank">Lecture 1</a>)
					</p>
					<p>
						We don't see centroid coordinates...
					</p>
					<p>
						$\Rightarrow$ Use the Add Geometry Attributes tool
					</p>
				</section>

				<section id="f2p" data-transition="fade-in slide-out" style="text-align: left;">
					<h4>
					Exercise #1: Step 3 (cont.)
					</h4>
					<h3>
						Add Geometry Attributes
					</h3>
					<p>
						To add the centroid coordinate values in attribute table
					</p>
					<p>
						<strong>Input Features</strong>: <code>fishnet.shp (2)</code>
					</p>
					<ul>
						<li>
							This is the output from Define Projection
						</li>
						<li>
							Don't choose <code>fishnet.shp</code> (which is the output from Create Fishnet)
						</li>
					</ul>
					<p>
						<strong>Geometry Properties</strong>: check CENTROID
					</p>
					<ul>
						<li>
							The CENTROID_INSIDE is for hollow polygons
						</li>
					</ul>
					<p>
						Note: this tool overwrites the input file
					</p>
				</section>

				<section id="ex1e" style="text-align: left;">
					<h4>
					Exercise #1 (cont.)
					</h4>
					<p>
						Now <em>save and</em> run the Model.
					</p>
					<p>
						Browse the output and its attribute table.
					</p>
					<p>
						Is everything as expected?
					</p>
				</section>


				<section id="ex2a" style="text-align: left;">
					<h4>
					Exercise #2
					</h4>
					<h3>
						Merge Ethnographic Atlas locations with 20th Century Reanalysis cells
					</h3>
					<p>
						1. Create a point feature class of Ethnographic Atlas locations
					</p>
						<ul>
							<li>
								We have XY data of Ethnographic Atlas locations (<code>Lecture2/ethnographic_atlas.csv</code>)
							</li>
							<li>
								Which geo-processing tools should we use? (hint: <a href="../gis_lecture1.html#/ex3a" target="_blank">Lecture 1 Exercise 3</a>)
							</li>
						</ul>
					<p>
						2. Spatially merge Ethnographic Atlas locations with 20th Century Reanalysis cells by Spatial Join
					</p>
					<p>
						We add these processes to the Model for Excercise 1
					</p>
				</section>

				<section id="ex2b" data-transition="slide-in fade-out" style="text-align: left;">
					<h4>
					Exercise #2: Step 1
					</h4>
					<h3>
						Make XY Event Layer
					</h3>
					<p>
						<strong>XY Table</strong>: <code>...\input\tribalmap.shp</code>
					</p>
					<ul>
						<li>Note this tool can be used for shapefiles</li>
					</ul>
					<p>
						<strong>X Field</strong>: <code>tribelon</code>
					</p>
					<p>
						<strong>Y Field</strong>: <code>tribelat</code>
					</p>
					<ul>
						<li>These two variables were most likely to be created with the Add Geometry Attributes tool (cf. <a href="#f2p">Exercise 1 Step 3</a>)</li>
					</ul>
					<p>
						<strong>Spatial Reference</strong>: GCS_WGS_1984
					</p>
					<p>
						Leave the other options as they are.
					</p>
				</section>

				<section id="ex2c" data-transition="slide-out fade-in" style="text-align: left;">
					<h4>
					Exercise #2: Step 1 (cont.)
					</h4>
					<h3>
						Copy Features
					</h3>
					<p>
						<strong>Input Features</strong>: tribalmap_Layer
					</p>
					<ul>
						<li>
							The output from Make XY Event Layer:
						</li>
						<li>
							Use the drop down menu
						</li>
					</ul>
					<p>
						<strong>Output Feature Class</strong>: <code>...\output\ethno_centroids.shp</code>
					</p>
				</section>

				<section id="ex2d"  style="text-align: left;">
					<h4>
					Exercise #2 (cont.)
					</h4>
					<p>
						Now <em>save and</em> run the Model.
					</p>
					<p>
						Browse the output and its attribute table.
					</p>
					<p>
						Is everything as expected?
					</p>
				</section>

				<section id="ex2e" data-transition="slide-in fade-out" style="text-align: left;">
					<h4>
					Exercise #2: Step 2
					</h4>
					<h3>
						Spatial Join
					</h3>
					<p>
						<strong>Target Feature Class</strong>: <code>ethno_centroids.shp</code>
					</p>
					<ul>
						<li>
							The output from Copy Features
						</li>
					</ul>
					<p>
						<strong>Join Features</strong>: <code>fishnet.shp</code>
					</p>
					<ul>
						<li>
							The output from Add Geometry Attributes (in Exercise 1)
						</li>
					</ul>
					<p>
						<strong>Output Feature Class</strong>: <code>...\output\ethno_centroids_with_20cr2.shp</code>
					</p>
				</section>

				<section id="ex2f" data-transition="slide-out fade-in" style="text-align: left;">
					<h3>
						Spatial Join (cont.)
					</h3>
					<p>
						<strong>Join Operation</strong>: JOIN_ONE_TO_ONE
					</p>
					<ul>
						<li>
							We match each ethnic group with one weather data cell
						</li>
					</ul>
					<p>
						Check "<strong>Keep All Target Features</strong>"
					</p>
					<ul>
						<li>
							We want to know which ethnic groups aren't matched with weather data, if any
						</li>
					</ul>
					<p>
						<strong>Field Map of Join Features</strong>: leave as it is
					</p>
					<p>
						<strong>Match Option</strong>: INTERSECT
					</p>
					<ul>
						<li>
							Each ethnic group's centroid should match with the weather cell that intersects it
						</li>
					</ul>
				</section>

				<section id="ex2g" style="text-align: left;">
					<h4>
					Exercise #2 (we're done!)
					</h4>
					<p>
						Now <em>save and</em> run the Model.
					</p>
					<ul>
						<li>
							I deliberately repeat this slide so you will form the habit of saving the Model before running it.
						</li>
					</ul>
					<p>
						Browse the output and its attribute table.
					</p>
					<p>
						Is everything as expected?
					</p>
				</section>

				<section id="why_polygon" style="text-align: left;">
					<h3>
					Why cell polygons for weather data?
					</h3>
					<p>
						If we match ethnic groups with weather data cell centroids...
					</p>
					<ul>
						<li>
							It is feasible with Spatial Join tool (CLOSEST as the Match Option)
						</li>
					</ul>
					<p>
						... it'll take <span style="font-size: 1.5em">a lot</span> of time
					</p>
					<ul>
						<li>
							Each of over <span style="font-size: 1.5em">843</span> ethnic groups will be matched with the nearest among <span style="font-size: 1.5em">1681</span> weather data cells</li>
					</ul>
					<p>
						Much quicker to match points with polygons by INTERSECT
					</p>
				</section>

				<section id="export0" data-transition="slide-in fade-out" style="text-align: left;">
					<h3>
					Export to Stata
					</h3>
					<p>
						Now we want to export the attribute table of <code>ethno_centroids_with_20cr2.shp</code> to Stata
					</p>
					<ul>
						<li>
							Then we can merge Ethnographic Atlas data with 20th Century Reanalysis data
						</li>
					</ul>
					<p>
						3 ways to export the attribute table to the format readable by Stata
					</p>
					<ul>
						<li>
							Table To Excel
						</li>
						<li>
							Export Feature Attribute to ASCII
						</li>
						<li>
							shp2dta (a STATA ado)
						</li>
					</ul>
				</section>

				<section id="export1" data-transition="fade-in fade-out" style="text-align: left;">
					<h4>
					Export to Stata (cont.)
					</h4>
					<h3>
					Table To Excel
					</h3>
					<p>
						Converts the attribute table into an Excel file
					</p>
					<p>
						Then use <code>import excel</code> in Stata
					</p>
					<p>
						But Excel cannot handle more than 65535 rows...
					</p>
				</section>

				<section id="export2" data-transition="fade-in fade-out" style="text-align: left;">
					<h4>
					Export to Stata (cont.)
					</h4>
					<h3>
					Export Feature Attribute to ASCII
					</h3>
					<p>
						Converts the attribute table into an ASCII text file
					</p>
					<p>
						Then use <code>import delimited</code> in Stata
					</p>
					<p>
						This tool will automatically add centroid coordinates to the output ASCII file
					</p>
				</section>

				<section id="export3" data-transition="fade-in slide-out" style="text-align: left;">
					<h4>
					Export to Stata (cont.)
					</h4>
					<h3>
					shp2dta
					</h3>
					<p>
						This Stata ado directly reads a shapefile's attribute table
					</p>
					<p>
						But it works <em>only with polygons</em>
					</p>
				</section>

				<section id="ex3a1" data-transition="slide-in fade-out" style="text-align: left;">
					<h4>
					Exercise #3
					</h4>
					<h3>
						Export Attribute Table
					</h3>
					<p>
						1. Table To Excel
					</p>
						<ul>
							<li>
								<strong>Input Table</strong> (use drop-down menu): <code>ethno_centroids_with_20cr2.shp</code>
							</li>
							<li>
								<strong>Output Excel File</strong>: <code>...\output\ethno_centroids_with_20cr2.xls</code>
							</li>
						</ul>
				</section>

				<section id="ex3a2" data-transition="fade -in fade-out" style="text-align: left;">
					<h4>
					Exercise #3
					</h4>
					<h3>
						Export Attribute Table (cont.)
					</h3>
					<p>
						2. Export Feature Attribute to ASCII
					</p>
						<ul>
							<li>
								<strong>Input Feature Class</strong> (use drop-down menu): <code>ethno_centroids_with_20cr2.shp</code>
							</li>
							<li>
								<strong>Value Field</strong>: NAME, TRIBE_CODE, CENTROID_X, CENTROID_Y
							</li>
							<li>
								<strong>Delimiter</strong>: SPACE
							</li>
					<ul>
						<li>
							Not COMMA, to avoid confusing with <a href="https://en.wikipedia.org/wiki/Decimal_mark#Countries_using_Arabic_numerals_with_decimal_comma" target="_blank">decimal mark</a>					</li>
					</ul>
							<li>
								<strong>Output ASCII File</strong>: <code>...\output\ethno_centroids_with_20cr2.txt</code>
							</li>
							<li>
								Check "<strong>Add Field Name to Output</strong>"
							</li>
						</ul>
				</section>

				<section id="ex3b" data-transition="slide-out fade-in" style="text-align: left;">
					<h4>
					Exercise #3 (cont.)
					</h4>
					<p>
						Browse the exported tables
					</p>
					<p>
						<code>ethno_centroids_with_20cr2.txt</code> has two additional columns
					</p>
						<ul>
							<li>
								<strong>XCoord</strong>: longitude
							</li>
							<li>
								<strong>YCoord</strong>: latitude
							</li>
						</ul>
					<p>
						Export Feature Attribute to ASCII is preferrable for
						<ul>
							<li>
								Controling which fields to be exported (ArcGIS tends to create tons of garbage fields)
							</li>
							<li>
								Dealing with 65535+ observations
							</li>
						</ul>
					</p>
					<p>
						But Table To Excel is simpler to execute
					</p>
				</section>

				<section id="model_model" style="text-align: left;">
					<h3>
					"Model" model for Lecture 2
					</h3>
					<p>
						Look at <code>lec2model.tbx/exercises1-3</code> in the downloaded data folder <code>solutions4exercises</code>
					</p>
				</section>
			</section>

			<section>
				<section id="section6">
					<h1>
						3. Introduction to Python for ArcGIS
					</h1>
				</section>

				<section id="why_python" style="text-align: left;">
					<h3>
						Why Python?
					</h3>
					<p>Essential for replication</p>
					<p>Convenient to repeat the same geo-processing</p>
					<ul>
						<li>
							When you obtain the updated version of input datasets
						</li>
						<li>
							When you change a process in the upstream
						</li>
						<li>
							Within a script by using a loop (L3, L6, L8)
						</li>
					</ul>
				</section>

				<section id="how_python" data-transition="slide-in fade-out" style="text-align: left;">
					<h3>
						How to write a Python script for ArcGIS?
					</h3>
					<p>Use Model Builder to write a draft script</p>
					<p>Then edit the draft script</p>
					<p>Throughout the course, we will learn various scripting tips</p>
				</section>

				<section id="ex4" data-transition="slide-out fade-in" style="text-align: left;">
					<h4>
					Exercise #4
					</h4>
					<h3>
						Export Python script from Model Builder
					</h3>
					<p>
						1. If the model is not opened yet, right-click the model in Catalogue Window and click "Edit"
					</p>
					<p>
						2. Click in the menu bar "Model > Export > To Python Script"
					</p>
					<p>
						3. Save as ***.py
					</p>
				</section>

				<section id="editors" data-transition="slide-in fade-out" style="text-align: left;">
					<h3>
						How to edit Python scripts
					</h3>
					<p>
						Use Python's default editor IDLE
					</p>
					<ul>
						<li>To run the script, you just need to press F5</li>
					</ul>
					<p>
						Or use your favourite text editor
					</p>
					<ul>
						<li>I recommend <a href="https://atom.io/" target="_blank">Atom</a>, with the <a href="https://atom.io/packages/script">Script</a> package</li>
					</ul>
				</section>

				<section id="ex5" data-transition="slide-out fade-in" style="text-align: left;">
					<h4>
					Exercise #5
					</h4>
					<h3>
						Use Python IDLE
					</h3>
					<p>
						1. Click the Windows icon at the bottom-left
					</p>
					<p>
						2. Click "All programs > ArcGIS > Python 2.7 > IDLE (Python GUI)"
					</p>
					<p>
						3. Click "File > Open" to read a script
					</p>
				</section>

				<section id="template1" data-transition="fade-out slide-in" style="text-align: left;">
					<h3>
						How to edit Python scripts (cont.)
					</h3>
					<p>
						Have your own template script for executing ArcGIS geo-processing tools
					</p>
					<p>
						Then copy-and-paste command lines from the exported script to your template
					</p>
					<ul>
						<li>
							This saves time
						</li>
						<li>
							Also avoid error making
						</li>
					</ul>
					<p>
						For this lecture, I prepare the template (Lecture2/template4L2.py) for you
					</p>
				</section>

				<section id="template2" data-transition="fade-in slide-out" style="text-align: left;">
					<h3>
						How to edit Python scripts (cont.)
					</h3>
					<p>
						Using this template script, we now learn the basics of Python scripting for ArcGIS
					</p>
					<p>
						cf. Interactive online tutorials for Python (for free):
					</p>
					<ul>
						<li>
							<a href="http://www.codecademy.com/learn/python" target="_blank">Codecademy</a>
						</li>
						<li>
							<a href="https://www.datacamp.com/courses/intro-to-python-for-data-science" target="_blank">Data Camp</a>
						</li>
					</ul>
				</section>

				<section id="python_essentials_1" style="text-align: left;">
					<h3>
						Python Essentials for ArcGIS
					</h3>
					<p>
						1. Object, Property, Method
					</p>
					<p style="color:slategrey">
						2. Try-Except statement
					</p>
					<p style="color:slategrey">
						3. String variables
					</p>
					<p style="color:slategrey">
						4. Print
					</p>
					<p style="color:slategrey">
						5. Comments
					</p>
				</section>

				<section id="object1" data-transition="fade-out slide-in" style="text-align: left;">
					<h4>Python Essentials for ArcGIS #1.1</h4>
					<h3>
						Object
					</h3>
					<p>
						An <strong>object</strong> is a set of commands
					</p>
					<img src="gis_lecture2/object.png" style="border:none; background:none; box-shadow:none; width:900px; vertical-align:middle;">
					<ul>
						<li>
							<code>arcpy</code> is an object containing all the ArcGIS geoprocessing tools
						</li>
					</ul>
					<p>
						The <code>import</code> command reads this object (i.e. launch ArcGIS)
					</p>
				</section>

				<section id="object2" data-transition="fade-in slide-out" style="text-align: left;">
					<h3>
						Object (cont.)
					</h3>
					<p>
						An object may contain smaller objects
					</p>
					<img src="gis_lecture2/subobject.png" style="border:none; background:none; box-shadow:none; width:900px; vertical-align:middle;">
					<ul>
						<li>
							<code>arcpy.env</code> is an object contained in <code>arcpy</code>
						</li>
					</ul>
					<p>
						Two types of commands in an object: <strong>property</strong> and <strong>method</strong>
					</p>
				</section>

				<section id="property" data-transition="fade" style="text-align: left;">
					<h4>Python Essentials for ArcGIS #1.2</h4>
					<h3>
						Property
					</h3>
					<p>
						Contains a value (numbers, strings, True/False)
					</p>
					<p>
						To assign a new value of the property, type:
					</p>
					<p style="text-align: center;">
						<code>object.property = value</code>
					</p>
					<img src="gis_lecture2/properties.png" style="border:none; background:none; box-shadow:none; width:900px; vertical-align:middle;">
					<ul>
						<li>
							<code>overwriteOutput</code>: whether the overwriting of output files is allowed
						</li>
						<li>
							<code>workspace</code>: working directory name
						</li>
					</ul>
				</section>

				<section id="overwrite" data-transition="fade" style="text-align: left;">
					<h4>Overwriting output files</h4>
					<p>
						By default, overwriting the output file is not allowed.
					</p>
					<ul>
						<li>
							Run a script. Browse the output. You're not satisfied. Revise the script. Run the script again.
						</li>
						<li>
							You'll then get an error.
						</li>
					</ul>
					<p>
						The following command line (case-sensitive!)
					</p>
					<p style="text-align: center;">
						<code>arcpy.env.overwriteOutput = True</code>
					</p>
					<p>
						allows you to overwrite output files.
					</p>
					<ul>
						<li>
							Note: Python is case-sensitive
						</li>
					</ul>
				</section>

				<section id="directory_name" data-transition="fade-in slide-out" style="text-align: left;">
					<h4>Directory Name in Python</h4>
					<p style="text-align: center;">
						<code>arcpy.env.workspace = "D:/temp"</code>
					</p>
					<p>
						Never use \
					</p>
					<ul>
						<li>
							In Python, \ is used for line continuation
						</li>
						<li>
							In Windows, \ is used for directory path
						</li>
					</ul>
					<p>
						Use / or \\
					</p>
					<ul>
						<li>
							The script exported from Model Builder uses \\
						</li>
					</ul>
				</section>

				<section id="method" data-transition="fade-out slide-in" style="text-align: left;">
					<h4>Python Essentials for ArcGIS #1.3</h4>
					<h3>
						Method
					</h3>
					<p>
						is a function (i.e. transform inputs into outputs)
					</p>
					<p>
						To use a method, type:
					</p>
					<p style="text-align: center;">
						<code>object.method(arg1, arg2, ...)</code>
					</p>
					<p>
						Each geo-processing tool in ArcGIS is a method of the <code>arcpy</code> object
					</p>
				</section>

				<section id="exported_script" data-transition="fade" style="text-align: left;">
					<h4>Exported Python script</h4>
					<img src="gis_lecture2/methods.png" style="border:none; background:none; box-shadow:none; width:900px; vertical-align:middle;">
				</section>

				<section id="why_model_builder" data-transition="fade" style="text-align: left;">
					<h3>
						Why we use Model Builder
					</h3>
					<p>
						The <code>arcpy</code> method names mix uppercase and lowercase letters as well as underscores
					</p>
					<p>
						Arguments for these methods are often very long with lots of <code>[ ] " ' ; ,</code> etc.
					</p>
					<p>
						$\Rightarrow$ Better to first use Model Builder to export the draft script (until you get used to Python programming)

					</p>
				</section>

				<section id="online_help" data-transition="slide-out fade-in" style="text-align: left;">
					<h3>
						Online Help for Arcpy Methods
					</h3>
					<p>
						Visit <a href="http://desktop.arcgis.com/en/" target="_blank">ArcGIS for Desktop website</a> and type the method name in the search field at the top row
					</p>
					<ul>
						<li>
							There's a built-in help, too, but the web version is more often updated
						</li>
					</ul>
					<ul>
						<li>
							Once we're used to Python, we will learn how to read this help document
						</li>
					</ul>
				</section>

				<section id="python_essentials_2" style="text-align: left;">
					<h3>
						Python Essentials for ArcGIS
					</h3>
					<p style="color:slategrey">
						1. Object, Property, Method
					</p>
					<p>
						2. Try-Except statement
					</p>
					<p style="color:slategrey">
						3. String variables
					</p>
					<p style="color:slategrey">
						4. Print
					</p>
					<p style="color:slategrey">
						5. Comments
					</p>
				</section>

				<section id="try-except1" data-transition="fade-out slide-in" style="text-align: left;">
					<h4>Python Essentials for ArcGIS #2</h4>
					<h3>
						Try-Except statement
					</h3>
					<p>
						If you simply run commands and get an error, you won't get a message on what went wrong
					</p>
					<p>
						Try-except statement is essential to know what the error is about
					</p>
				</section>

				<section id="try-except2" data-transition="fade-in slide-out" style="text-align: left;">
					<h3>
						Try-Except statement (cont.)
					</h3>
					<p>
						Python first attempts to execute <em>indented</em> commands below <code>try:</code>
					<p>
						If there is no error:
					</p>
					<p style="margin-left: 30px;">
						Pythoh skip all the indented commands after <code>except:</code>
					</p>
					<p>
						If there is an error:
					</p>
					<p style="margin-left: 30px;">
						Python execute the indented commands below <code>except:</code>
					</p>
					<p>
						$\Rightarrow$ Write commands for error messages after <code>except:</code>
					</p>
				</section>

				<section id="ex6a" data-transition="slide-in fade-out" style="text-align: left;">
					<h4>
					Exercise #6
					</h4>
					<h3>
						Use try-except statement
					</h3>
					<p>
						1. Copy the geoprocessing commands in the exported script
					</p>
					<p>
						2. Paste them between <code>try:</code> and <code>except:</code> in the template script
					</p>
					<p>
						3. Select commands to be indented
					</p>
					<p>
						4. Click "Format > Indent Region"
					</p>
					<ul style="margin-left: 75px;">
						<li>
							Best avoid using the tab key to indent commands
						</li>
					</ul>
				</section>

				<section id="ex6b" data-transition="slide-out fade-in" style="text-align: left;">
					<h4>
						You should have something like this:
					</h4>
					<pre>
						<code data-trim>
############################## Geoprocessing ##########################
try:
    # Process: Create Fishnet
    arcpy.CreateFishnet_management(fishnet_shp, "-21 -41", "-21 -10", "2", "2", "41", "41", "", "NO_LABELS", "DEFAULT", "POLYGON")

    # Process: Make XY Event Layer
    arcpy.MakeXYEventLayer_management(tribalmap_shp, "lon", "lat", tribalmap_Layer, "GEOGCS['GCS_WGS_1984',DATUM['D_WGS_1984',SPHEROID['WGS_1984',6378137.0,298.257223563]],PRIMEM['Greenwich',0.0],UNIT['Degree',0.0174532925199433]];-400 -400 1000000000;-100000 10000;-100000 10000;8.98315284119522E-09;0.001;0.001;IsHighPrecision", "")

    # Process: Copy Features
    arcpy.CopyFeatures_management(tribalmap_Layer, ethno_centroids_shp, "", "0", "0", "0")

    # Process: Define Projection
    arcpy.DefineProjection_management(fishnet_shp, "GEOGCS['GCS_WGS_1984',DATUM['D_WGS_1984',SPHEROID['WGS_1984',6378137.0,298.257223563]],PRIMEM['Greenwich',0.0],UNIT['Degree',0.0174532925199433]]")

    # Process: Add Geometry Attributes
    arcpy.AddGeometryAttributes_management(fishnet_shp__2_, "CENTROID", "", "", "")

    # Process: Spatial Join
    arcpy.SpatialJoin_analysis(ethno_centroids_shp, fishnet_shp__4_, ethno_centroid_with_20cr_shp, "JOIN_ONE_TO_ONE", "KEEP_ALL", "", "INTERSECT", "", "")

    # Process: Table To Excel
    arcpy.TableToExcel_conversion(ethno_centroid_with_20cr_shp, ethno_centroid_with_20cr_xls, "NAME", "CODE")

    # Process: Export Feature Attribute to ASCII
    arcpy.ExportXYv_stats(ethno_centroid_with_20cr_shp, "CENTROID_X;CENTROID_Y;NAME;TRIBE_CODE", "SPACE", ethno_centroid_with_20cr_txt, "ADD_FIELD_NAMES")

# Return geoprocessing specific errors
except arcpy.ExecuteError:
    print arcpy.GetMessages()
						</code>
					</pre>
				</section>

				<section id="python_essentials_3" style="text-align: left;">
					<h3>
						Python Essentials for ArcGIS
					</h3>
					<p style="color:slategrey">
						1. Object, Property, Method
					</p>
					<p style="color:slategrey">
						2. Try-Except statement
					</p>
					<p>
						3. String variables
					</p>
					<p style="color:slategrey">
						4. Print
					</p>
					<p style="color:slategrey">
						5. Comments
					</p>
				</section>

				<section id="strings1" data-transition="slide-in fade-out" style="text-align: left;">
					<h4>Python Essentials for ArcGIS #3</h4>
					<h3>
						String variables
					</h3>
					<p>
						It's a Python's equivalent of local macro in Stata
					</p>
					<p>
						Recommended to assign a string variable to each data file name in the Python script
					</p>
					<ul>
						<li>
							You may later want to use a different input file for the same data processing
						</li>
						<li>
							Then you just need to change one line in the script where the input file name is defined
						</li>
					</ul>
				</section>

				<section id="strings2" data-transition="fade-in slide-out" style="text-align: left;">
					<h3>
						String variables (cont.)
					</h3>
					<p>
						To create a variable called <code>file1</code> which contains a string <code>data.shp</code>, type
					</p>
					<p style="text-align: center;">
						<code>file1 = "data.shp"</code>
					</p>
					<ul>
						<li>
							Don't forget to enclose the file name with double quotation marks
						</li>
					</ul>

				</section>

				<section id="ex7a" data-transition="fade-out slide-in" style="text-align: left;">
					<h4>
					Exercise #7
					</h4>
					<h3>
						Edit file names
					</h3>
					<p>
						1. Copy local variables in the exported script
					</p>
					<p>
						2. Paste them before <code>try:</code> in the template script
					</p>
					<p>
						3. Sort these names by inputs, intermediates, and outputs
					</p>
					<p>
						4. Assign the directory path for outputs to <code>arcpy.env.workspace</code>
					</p>
					<p>
						5. Delete the directory path for outputs and intermediates
					</p>

				</section>

				<section id="ex7b" data-transition="fade" style="text-align: left;">
					<h4>
					Exercise #7 (cont.)
					</h4>
					<p>
						Now notice
					</p>
						<code data-trim>
fishnet_shp__2_ = fishnet_shp
fishnet_shp__4_ = fishnet_shp__2_
						</code>
					<p>
						This happens when we use overwriting geoprocessing tools (Define Projection, Add Geometry Attributes)
					</p>
					<p>
						It's confusing. So:
					</p>
					<p>
						6. Use "Edit > Replace" to replace:
					</p>
					<ul>
						<li>
							 <code>fishnet_shp__2_</code> with <code>fishnet_shp</code>
						</li>
						<li>
							 <code>fishnet_shp__4_</code> with <code>fishnet_shp</code>
						</li>
					</ul>
					<p>
						7. Delete the duplicated lines
					</p>
				</section>

				<section id="ex7c" data-transition="fade-in slide-out" style="text-align: left;">
					<h4>
						You should now have something like this:
					</h4>
					<pre>
						<code data-trim contenteditable>
import arcpy

### Set environment ###
# Allow the overwriting of the output files
arcpy.env.overwriteOutput = True # This command is CASE-SENSITIVE
# Set the working directory.
arcpy.env.workspace = "C:\\Users\\Masayuki Kudamatsu\\Desktop\\Lecture2" # NEVER USE single backslash (\).

### Local variables ###
tribalmap_shp = "input\\tribalmap.shp"

tribalmap_Layer = "tribalmap_Layer"
ethno_centroids_shp = "output\\ethno_centroids.shp"
fishnet_shp = "output\\fishnet.shp"

ethno_centroid_with_20cr_shp = "output\\ethno_centroid_with_20cr.shp"
ethno_centroid_with_20cr_xls = "output\\ethno_centroid_with_20cr.xls"
ethno_centroid_with_20cr_txt = "output\\ethno_centroid_with_20cr.txt"

############################## Geoprocessing ##########################
try:
    # Process: Create Fishnet
						</code>
					</pre>
				</section>

				<section id="python_essentials_4" style="text-align: left;">
					<h3>
						Python Essentials for ArcGIS
					</h3>
					<p style="color:slategrey">
						1. Object, Property, Method
					</p>
					<p style="color:slategrey">
						2. Try-Except statement
					</p>
					<p style="color:slategrey">
						3. String variables
					</p>
					<p>
						4. Print
					</p>
					<p style="color:slategrey">
						5. Comments
					</p>
				</section>

				<section id="print1" data-transition="fade-out slide-in" style="text-align: left;">
					<h4>Python Essentials for ArcGIS #4</h4>
					<h3>
						Print
					</h3>
					<p>
						It's a Python's equivalent of <code>display</code> in Stata
					</p>
					<p>
						To show a message on the IDLE screen while running the script, type:
					</p>
					<p style="text-align: center;">
						<code>print "message"</code>
					</p>
					<ul>
						<li>
							Tells which part of the script is currently run
						</li>
						<li>
							Lets you know where the script caused an error
						</li>
						<li>
							Can be used to display a value that a method returns
						</li>
					<p style="text-align: center;">
						<code>print arcpy.GetMessages()</code>
					</p>
					</ul>
				</section>

				<section id="ex8a" data-transition="fade" style="text-align: left;">
					<h4>
					Exercise #8
					</h4>
					<h3>
						Add print commands
					</h3>
					<p>
						For each geo-processing step, add the <code>print</code> command to explain what's being processsed.
					</p>
					<p>
						Also add the print commands at the beginning of the script
					</p>
				</section>


				<section id="ex8b"  data-transition="fade" style="text-align: left;">
					<h4>
						You should now have something like this:
					</h4>
					<pre>
						<code data-trim contenteditable>
############################## Preamble #################################
print "Launch ArcGIS"
import arcpy

### Set environment ###
print "Enable the overwriting"
arcpy.env.overwriteOutput = True # This command is CASE-SENSITIVE
print "Set the working directory"
arcpy.env.workspace = "C:\\Users\\Masayuki Kudamatsu\\Desktop\\Lecture2" # NEVER USE single backslash (\).

### Local variables ###
print "Input file names being set"
tribalmap_shp = "input\\tribalmap.shp"

print "Intermediate file names being set"
tribalmap_Layer = "tribalmap_Layer"
ethno_centroids_shp = "output\\ethno_centroids.shp"
fishnet_shp = "output\\fishnet.shp"

print "Output files being set"
ethno_centroid_with_20cr_shp = "output\\ethno_centroid_with_20cr.shp"
ethno_centroid_with_20cr_xls = "output\\ethno_centroid_with_20cr.xls"
ethno_centroid_with_20cr_txt = "output\\ethno_centroid_with_20cr.txt"
						</code>
					</pre>
				</section>
				<section id="ex8c" data-transition="fade-in slide-out" style="text-align: left;">
					<h4>
						You should now have something like this (cont.):
					</h4>
					<pre>
						<code data-trim contenteditable>
############################## Geoprocessing ##########################
try:
    print "Create 20th Century Reanalysis data cell polygons step 1/3"
    arcpy.CreateFishnet_management(fishnet_shp, "-21 -41", "-21 -10", "2", "2", "41", "41", "", "NO_LABELS", "DEFAULT", "POLYGON")

    print "Create 20th Century Reanalysis data cell polygons step 2/3"
    arcpy.DefineProjection_management(fishnet_shp, "GEOGCS['GCS_WGS_1984',DATUM['D_WGS_1984',SPHEROID['WGS_1984',6378137.0,298.257223563]],PRIMEM['Greenwich',0.0],UNIT['Degree',0.0174532925199433]]")

    print "Create 20th Century Reanalysis data cell polygons step 3/3"
    arcpy.AddGeometryAttributes_management(fishnet_shp, "CENTROID", "", "", "")

    print "Create ethnic group centroids step 1/2"
    arcpy.MakeXYEventLayer_management(tribalmap_shp, "lon", "lat", tribalmap_Layer, "GEOGCS['GCS_WGS_1984',DATUM['D_WGS_1984',SPHEROID['WGS_1984',6378137.0,298.257223563]],PRIMEM['Greenwich',0.0],UNIT['Degree',0.0174532925199433]];-400 -400 1000000000;-100000 10000;-100000 10000;8.98315284119522E-09;0.001;0.001;IsHighPrecision", "")

    print "Create ethnic group centroids step 2/2"
    arcpy.CopyFeatures_management(tribalmap_Layer, ethno_centroids_shp, "", "0", "0", "0")

    print "Match Ethnographic Atlas ethnic groups with 20th Century Reanalysis data cells"
    arcpy.SpatialJoin_analysis(ethno_centroids_shp, fishnet_shp, ethno_centroid_with_20cr_shp, "JOIN_ONE_TO_ONE", "KEEP_ALL", "", "INTERSECT", "", "")

    print "Export output data as Excel sheet"
    arcpy.TableToExcel_conversion(ethno_centroid_with_20cr_shp, ethno_centroid_with_20cr_xls, "NAME", "CODE")

    print "Export output data as csv file"
    arcpy.ExportXYv_stats(ethno_centroid_with_20cr_shp, "CENTROID_X;CENTROID_Y;NAME;TRIBE_CODE", "SPACE", ethno_centroid_with_20cr_txt, "ADD_FIELD_NAMES")

# Return geoprocessing specific errors
except arcpy.ExecuteError:
						</code>
					</pre>
				</section>

				<section id="python_essentials_5" style="text-align: left;">
					<h3>
						Python Essentials for ArcGIS
					</h3>
					<p style="color:slategrey">
						1. Object, Property, Method
					</p>
					<p style="color:slategrey">
						2. Try-Except statement
					</p>
					<p style="color:slategrey">
						3. String variables
					</p>
					<p style="color:slategrey">
						4. Print
					</p>
					<p>
						5. Comments
					</p>
				</section>


				<section id="comment1" data-transition="slide-in fade-out" style="text-align: left;">
					<h4>Python Essentials for ArcGIS #5</h4>
					<h3>
						Comment
					</h3>
					<p>
						To insert comments, type <code>#</code> at the beginning of a comment
					</p>
					<p>
						Useful for others to understand (and for you to remember) what each command does
					</p>
					<p>
						Also useful if you want to skip some commands for the time being
					</p>
				</section>

				<section id="ex9a" data-transition="fade" style="text-align: left;">
					<h4>
					Exercise #9
					</h4>
					<h3>
						Skip command lines temporarily
					</h3>
					<p>
						Suppose you're not sure if this script will properly create ethnic group centroids.
					</p>
					<p>
						So you want to skip the other parts of the script for the time being.
					</p>
					<p>
						1. Select command lines to be skipped
					</p>
					<ul>
						<li>
							Don't skip the <code>except:</code> part
						</li>
						<li>
							You want to show the error message
						</li>
					</ul>
					<p>
						2. Click "Format > Comment Out Region"
					</p>
					<p>
						$\Rightarrow$ <code>##</code> will appear at the beginning of selected commands
					</p>
				</section>

				<section id="ex9b" data-transition="fade" style="text-align: left;">
					<h4>
						You should have something like this:
					</h4>
					<pre>
						<code data-trim contenteditable>
############################## Geoprocessing ##########################
try:
##    print "Create 20th Century Reanalysis data cell polygons step 1/3"
##    arcpy.CreateFishnet_management(fishnet_shp, "-21 -41", "-21 -10", "2", "2", "41", "41", "", "NO_LABELS", "DEFAULT", "POLYGON")
##
##    print "Create 20th Century Reanalysis data cell polygons step 2/3"
##    arcpy.DefineProjection_management(fishnet_shp, "GEOGCS['GCS_WGS_1984',DATUM['D_WGS_1984',SPHEROID['WGS_1984',6378137.0,298.257223563]],PRIMEM['Greenwich',0.0],UNIT['Degree',0.0174532925199433]]")
##
##    print "Create 20th Century Reanalysis data cell polygons step 3/3"
##    arcpy.AddGeometryAttributes_management(fishnet_shp, "CENTROID", "", "", "")

    arcpy.MakeXYEventLayer_management(tribalmap_shp, "lon", "lat", tribalmap_Layer, "GEOGCS['GCS_WGS_1984',DATUM['D_WGS_1984',SPHEROID['WGS_1984',6378137.0,298.257223563]],PRIMEM['Greenwich',0.0],UNIT['Degree',0.0174532925199433]];-400 -400 1000000000;-100000 10000;-100000 10000;8.98315284119522E-09;0.001;0.001;IsHighPrecision", "")
    print "Create ethnic group centroids step 1/2"

    print "Create ethnic group centroids step 2/2"
    arcpy.CopyFeatures_management(tribalmap_Layer, ethno_centroids_shp, "", "0", "0", "0")

##    print "Match Ethnographic Atlas ethnic groups with 20th Century Reanalysis data cells"
##    arcpy.SpatialJoin_analysis(ethno_centroids_shp, fishnet_shp, ethno_centroid_with_20cr_shp, "JOIN_ONE_TO_ONE", "KEEP_ALL", "", "INTERSECT", "", "")
##
##    print "Export output data as Excel sheet"
##    arcpy.TableToExcel_conversion(ethno_centroid_with_20cr_shp, ethno_centroid_with_20cr_xls, "NAME", "CODE")
##
##    print "Export output data as csv file"
##    arcpy.ExportXYv_stats(ethno_centroid_with_20cr_shp, "CENTROID_X;CENTROID_Y;NAME;TRIBE_CODE", "SPACE", ethno_centroid_with_20cr_txt, "ADD_FIELD_NAMES")

# Return geoprocessing specific errors
except arcpy.ExecuteError:
						</code>
					</pre>
				</section>


				<section id="ex9c" data-transition="fade" style="text-align: left;">
					<h4>
					Exercise #9 (cont.)
					</h4>
					<p>
						3. <em>Save and</em> run the script (press F5)
					</p>
					<p>
						4. Cross your fingers :)
					</p>
					<p>
						5. Check if <code>ethno_centroids.shp</code> is created properly.
					</p>
					<ul>
						<li>
							Don't forget Refresh if you don't see it
						</li>
					</ul>
					<p>
						6. If so, uncomment those skipped commands
					</p>
					<ul>
						<li>
							Click "Format > Uncomment Region" in IDLE menu bar
						</li>
					</ul>
					<p>
						7. <em>Save and</em> run the script (press F5)
					</p>
					<p>
						8. Cross your fingers :)
					</p>
					<p>
						9. Check if everything is as expected
					</p>
				</section>

				<section id="ex9e" data-transition="slide-out fade-in" style="text-align: left;">
					<h4>
					Exercise #9 (cont.)
					</h4>
					<p>
						Most likely, you get an error message:
					</p>
					<p>
						<code>ERROR 000464: Cannot get exclusive schema lock. Either being edited or in use by another application.</code>
					</p>
					<p>
						This error occurs when the script is trying to overwrite the output that's been shown in ArcMap
					</p>
					<p>
						Before you run the Python script, close all the output files in ArcMap
					</p>
				</section>

				<section id="error_handling" style="text-align: left;">
					<h4>
					Error handling
					</h4>
					<p>
						Sometimes, the output file is not what you intended.
					</p>
					<p style="margin-left: 60px;">
						e.g., New fields in the attribute table are all zero
					</p>
					<p>
						Revising the script may not solve the issue / You cannot find anything wrong with the script
					</p>
					<p>
						If so, reboot Windows. This often solves the issue.
					</p>
					<p>
						Still unsolved, ask Google.
					</p>
					<ul>
						<li>
							Someone else may have had the same problem and posted the question on the web
						</li>
						<li>
							And ArcGIS experts may have answered the question
						</li>
					</ul>
					<p>
						Last resort: ask at <a href="http://stackexchange.com/" target="_blank">Stack Exchange</a> or <a href="http://forums.arcgis.com" target="_blank">ArcGIS Forum</a>.
					</p>
				</section>

				<section id="model_script" style="text-align: left;">
					<h3>
					Model Python Script for Lecture 2
					</h3>
					<p>
						Look at
					</p>
					<p>
						<code>solutions4exercises/lec2script.py</code>
					</p>
					<p>in the downloaded data folder for Lecture 2</p>
				</section>
			</section>

				<section id="lessons" style="text-align: left;">
					<h3>
						What we've learned on ArcGIS
					</h3>
					<ol>
						<li>
							Create a graticule shapefile
						</li>
						<li>
						Merge two vector datasets spatially
						</li>
					</ol>
					<p>
						Do you remember which geo-processing tools you used for each of these tasks?
					</p>
				</section>

			</div>
			<!-- To end the reconfiguration of an HTML5 <section> element as a slide using CSS. -->

		</div>
		<!-- To end the activation of the CSS framework of Reveal.js -->

		<!-- Java script commands should be placed at the bottom of an HTML file, to reduce the perceived loading time  -->

		<!-- Load head.js, providing a number of utility classses. http://headjs.com/ -->
		<script src="lib/js/head.min.js"></script>
		<!-- Load reveal.js -->
		<script src="js/reveal.js"></script>

		<!-- Import MathJax, to use TeX for mathematic expressions -->
		<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
		<!-- Allow inline math expressions by using $ -->
		<!-- http://tex.stackexchange.com/questions/27633/mathjax-inline-mode-not-rendering -->
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
		    tex2jax: {
		      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
		      processEscapes: true
		    }
		  });
		</script>

		<script>
			// Set the options for Reveal.js
			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true, // Enable the navigation arrows on bottom right
				progress: true,
				history: true,
				center: true,
				rollingLinks: false, // Disable the default rolling links

				transition: 'slide', // Choose from: none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
